<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Theme Butik</name>
    <code>Theme_Butik</code>
    <version>1.1.1</version>
    <author>DSV</author>
    <link>https://kreativ.pro/</link>

    <file path="catalog/controller/common/header.php">
        <operation>
            <search><![CDATA[$this->load->language('common/header');]]></search>
            <add position="after"><![CDATA[
            $this->load->language('extension/module/butik');
            $data['language_id'] = $this->config->get('config_language_id');
            $language_id = $this->config->get('config_language_id');

            $data['butik_menu_align'] = $this->config->get('theme_butik_menu_align');
            $data['butik_topmenu_status'] = $this->config->get('theme_butik_topmenu_status');
            $data['butik_compare_status'] = $this->config->get('theme_butik_compare_status');
            $data['butik_wishlist_status'] = $this->config->get('theme_butik_wishlist_status');

            $data['theme_butik_top_link'] = array();
            $top_link_add = $this->config->get('theme_butik_top_link');
            if (!empty($top_link_add)){
                foreach ($top_link_add as $key => $value) {
                    $data['top_link_add'][] = array(
                        'title'  => $value['title'][$this->config->get('config_language_id')],
                        'link'   => $value['link'][$this->config->get('config_language_id')]
                    );
                    $top_link_add_sort[$key] = $value['sort'];
                }
                array_multisort($top_link_add_sort, SORT_ASC, $data['top_link_add']);
            }

            $data['theme_butik_header_phone'] = array();
            $header_phones = $this->config->get('theme_butik_header_phone');
            if (!empty($header_phones)){
                foreach ($header_phones as $key => $value) {
                    $data['header_phones'][] = array(
                        'phone'  => $value['phone'],
                        'link'   => preg_replace('![^0-9]+!', '', $value['phone'])
                    );
                    $header_phones_sort[$key] = $value['sort'];
                }
                array_multisort($header_phones_sort, SORT_ASC, $data['header_phones']);
            }

            $contact_schedule = $this->config->get('theme_butik_header_schedule');
            if(empty($contact_schedule[$this->config->get('config_language_id')])) {
                $data['contact_schedule'] = false;
            } elseif (isset($contact_schedule[$this->config->get('config_language_id')])) {
                $data['contact_schedule'] = html_entity_decode($contact_schedule[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $data['butik_compare'] = sprintf($this->language->get('butik_compare'), (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0));
            $data['compare'] = $this->url->link('product/compare', '', true);
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/common/menu.php">
        <operation>
            <search><![CDATA[$this->load->language('common/menu');]]></search>
            <add position="after"><![CDATA[
            $this->load->model('tool/image');
            $this->load->model('catalog/manufacturer');
            $this->load->language('extension/module/butik');
            $data['language_id'] = $this->config->get('config_language_id');
            $language_id = $this->config->get('config_language_id');

            $data['butik_home_link'] = $this->config->get('theme_butik_home_link');
            $data['butik_category_thumb'] = $this->config->get('theme_butik_category_thumb');
            $data['butik_brands_status'] = $this->config->get('theme_butik_brands_status');
            $data['butik_html_block_status1'] = $this->config->get('theme_butik_html_block_status1');
            $data['butik_html_block_status2'] = $this->config->get('theme_butik_html_block_status2');
            $data['butik_html_block_status3'] = $this->config->get('theme_butik_html_block_status3');
            $data['butik_information_status'] = $this->config->get('theme_butik_information_status');
            $data['butik_contact_status'] = $this->config->get('theme_butik_contact_status');
            $data['butik_fixed_menu'] = $this->config->get('theme_butik_fixed_menu');

            $data['home'] = $this->url->link('common/home');
            $data['manufacturer'] = $this->url->link('product/manufacturer');
            $data['contact'] = $this->url->link('information/contact');

            $title_brands = $this->config->get('theme_butik_title_brands');
            if(empty($title_brands[$this->config->get('config_language_id')])) {
                $data['title_brands'] = false;
            } elseif (isset($title_brands[$this->config->get('config_language_id')])) {
                $data['title_brands'] = html_entity_decode($title_brands[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $data['theme_butik_menu_link'] = array();
            $menu_link_add = $this->config->get('theme_butik_menu_link');
            if (!empty($menu_link_add)){
                foreach ($menu_link_add as $key => $value) {
                    $data['menu_link_add'][] = array(
                        'title'  => $value['title'][$this->config->get('config_language_id')],
                        'link'   => $value['link'][$this->config->get('config_language_id')]
                    );
                    $menu_link_add_sort[$key] = $value['sort'];
                }
                array_multisort($menu_link_add_sort, SORT_ASC, $data['menu_link_add']);
            }

            $brand_info = $this->model_catalog_manufacturer->getManufacturers();
            foreach ($brand_info as $result) {
                if ($result['image']) {
                    $image = $result['image'];
                } else {
                    $image = 'no_image.jpg';
                }
                $data['manufacturers'][] = array(
                    'name' => $result['name'],
                    'image' => $this->model_tool_image->resize($image, 80, 60),
                    'href' => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $result['manufacturer_id'])
                );
            }

            $this->load->model('catalog/information');
            $data['informations'] = array();
            foreach ($this->model_catalog_information->getInformations() as $result) {
                if ($result['bottom']) {
                    $data['informations'][] = array(
                        'title' => $result['title'],
                        'href'  => $this->url->link('information/information', 'information_id=' . $result['information_id'])
                    );
                }
            }

            $html_title1 = $this->config->get('theme_butik_tab1_title');
            if(empty($html_title1[$this->config->get('config_language_id')])) {
                $data['html_title1'] = false;
            } elseif (isset($html_title1[$this->config->get('config_language_id')])) {
                $data['html_title1'] = html_entity_decode($html_title1[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $html_title2 = $this->config->get('theme_butik_tab2_title');
            if(empty($html_title2[$this->config->get('config_language_id')])) {
                $data['html_title2'] = false;
            } elseif (isset($html_title2[$this->config->get('config_language_id')])) {
                $data['html_title2'] = html_entity_decode($html_title2[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $html_title3 = $this->config->get('theme_butik_tab3_title');
            if(empty($html_title3[$this->config->get('config_language_id')])) {
                $data['html_title3'] = false;
            } elseif (isset($html_title3[$this->config->get('config_language_id')])) {
                $data['html_title3'] = html_entity_decode($html_title3[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $html_content1 = $this->config->get('theme_butik_tab1_content');
            if(empty($html_content1[$this->config->get('config_language_id')])) {
                $data['html_content1'] = false;
            } elseif (isset($html_content1[$this->config->get('config_language_id')])) {
                $data['html_content1'] = html_entity_decode($html_content1[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $html_content2 = $this->config->get('theme_butik_tab2_content');
            if(empty($html_content2[$this->config->get('config_language_id')])) {
                $data['html_content2'] = false;
            } elseif (isset($html_content2[$this->config->get('config_language_id')])) {
                $data['html_content2'] = html_entity_decode($html_content2[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            $html_content3 = $this->config->get('theme_butik_tab3_content');
            if(empty($html_content3[$this->config->get('config_language_id')])) {
                $data['html_content3'] = false;
            } elseif (isset($html_content3[$this->config->get('config_language_id')])) {
                $data['html_content3'] = html_entity_decode($html_content3[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
            }

            ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$children_data[] = array(]]></search>
            <add position="before"><![CDATA[
                $sub_children_data = array();
                    $sub_children = $this->model_catalog_category->getCategories($child['category_id']);

                    foreach($sub_children as $sub_child) {
                        $child_filter_data = array(
                            'filter_category_id' => $sub_child['category_id'],
                            'filter_sub_category' => true
                        );

                        $sub_children_data[] = array(
                            'name' => $sub_child['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($child_filter_data) . ')' : ''),
                            'href' => $this->url->link('product/category', 'path=' . $category['category_id'] . '_' . $child['category_id'] . '_' . $sub_child['category_id'])
                        );
                    }

                    if ($child['image']) {
                        $category_2_image = $this->model_tool_image->resize($child['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_category_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_category_thumb_height'));
                    } else {
                        $category_2_image = '';
                    }
            ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$children_data[] = array(]]></search>
            <add position="after"><![CDATA[
                        'thumb'        => $category_2_image,
                        'sub_children' => $sub_children_data,]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/common/cart.php">
        <operation>
            <search><![CDATA[$this->load->language('common/cart');]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/module/butik');]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/checkout/cart.php">
        <operation>
            <search><![CDATA[$this->load->language('checkout/cart');]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/module/butik');]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="after"><![CDATA[
            $this->load->language('extension/module/butik');

            if ($this->config->get('theme_butik_module_scroll') || $this->config->get('theme_butik_scroll_img') || $this->config->get('theme_butik_quickview_status')) {
                $this->document->addStyle('catalog/view/theme/butik/js/owl-carousel/owl.carousel.css');
                $this->document->addScript('catalog/view/theme/butik/js/owl-carousel/owl.carousel.min.js');
            }

            $data['butik_microdata_status'] = $this->config->get('theme_butik_microdata_status');
            $data['butik_zoom_img'] = $this->config->get('theme_butik_zoom_img');
            $data['butik_scroll_img'] = $this->config->get('theme_butik_scroll_img');
            $data['butik_manufacturer_img'] = $this->config->get('theme_butik_manufacturer_img');
            $data['butik_compare_status'] = $this->config->get('theme_butik_compare_status');
            $data['butik_wishlist_status'] = $this->config->get('theme_butik_wishlist_status');
            $data['butik_no_product'] = $this->config->get('theme_butik_no_product');
            $data['butik_fastorder_status'] = $this->config->get('module_butik_fastorder_status');
            $data['butik_fastorder_module'] = $this->config->get('module_butik_fastorder_module');
            $data['butik_module_scroll'] = $this->config->get('theme_butik_module_scroll');
            $data['butik_short_description_status'] = $this->config->get('theme_butik_short_description_status');
            $data['butik_percentage_status'] = $this->config->get('theme_butik_percentage_status');
            $data['butik_hover_img_status'] = $this->config->get('theme_butik_hover_img_status');
            $data['butik_additional_tabs_status'] = $this->config->get('module_butik_additional_tabs_status');
            $data['butik_quickview_status'] = $this->config->get('theme_butik_quickview_status');
            $data['butik_cheaper_status'] = $this->config->get('module_butik_cheaper_status');

            $data['currency_code'] = $this->session->data['currency'];
            $data['w_price'] = preg_replace("/[^0-9]/", "", $this->currency->format($product_info['special'] ? $product_info['special'] : $product_info['price'], $this->session->data['currency']));
            $data['w_reviews'] = $product_info['reviews'];

            if ($product_info['image']) {
                $data['thumb_additional'] = $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height'));
            } else {
                $data['thumb_additional'] = '';
            }

            $butik_soc_code = $this->config->get('theme_butik_soc_code');
            if(empty($butik_soc_code)) {
                $data['butik_soc_code'] = false;
            } elseif (isset($butik_soc_code)) {
                $data['butik_soc_code'] = html_entity_decode($butik_soc_code, ENT_QUOTES, 'UTF-8');
            }

            $data['manufacturer_img'] = false;
            if ($product_info['manufacturer_id']){
                $manufacturer_img = $this->model_catalog_manufacturer->getManufacturer($product_info['manufacturer_id']);

                if($manufacturer_img['image']) {
                    $data['manufacturer_img'] = $this->model_tool_image->resize($manufacturer_img['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_manufacturer_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_manufacturer_thumb_height'));
                } else {
                    $data['manufacturer_img'] = '';
                }
            }
            ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$data['images'][] = array(]]></search>
            <add position="after"><![CDATA['thumb_zoom' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')),]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="before" error="skip"><![CDATA[
                $additional_img = $this->model_catalog_product->getProductImages($result['product_id']);

                if (isset($additional_img[0]['image']) && !empty($additional_img[0]['image'])) {
                  $additional_img = $this->model_tool_image->resize($additional_img[0]['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_related_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_related_height'));
                } else {
                  $additional_img = false;
                }
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="after" error="skip"><![CDATA['additional_img' => $additional_img,
                'product_quantity' => $result['quantity'],
                'entry_stock' => $result['stock_status'],]]></add>
        </operation>
        <operation>
            <search><![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'])]]></search>
            <add position="replace"><![CDATA['href'      => $this->url->link('product/product', 'product_id=' . $result['product_id']),
          'percentage' => $result['price'] == 0 ? 100 : round((($result['price'] - $result['special'])/$result['price'])*100, 0)]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="before"><![CDATA[
                $data['product_quantity'] = $product_info['quantity'];
                $data['entry_stock'] = $product_info['stock_status'];
            ]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/common/footer.php">
        <operation>
            <search><![CDATA[$this->load->language('common/footer');]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/module/butik');
        $data['language_id'] = $this->config->get('config_language_id');
        $language_id = $this->config->get('config_language_id');
        $this->load->model('tool/image');

        $data['butik_callback_status'] = $this->config->get('module_butik_callback_status');
        $data['butik_backtotop_status'] = $this->config->get('theme_butik_backtotop_status');
        $data['butik_footer_contact_status'] = $this->config->get('theme_butik_footer_contact_status');
        $data['butik_footer_sitemap_status'] = $this->config->get('theme_butik_footer_sitemap_status');
        $data['butik_footer_account_status'] = $this->config->get('theme_butik_footer_account_status');
        $data['butik_footer_order_status'] = $this->config->get('theme_butik_footer_order_status');
        $data['butik_footer_wishlist_status'] = $this->config->get('theme_butik_footer_wishlist_status');
        $data['butik_footer_newsletter_status'] = $this->config->get('theme_butik_footer_newsletter_status');
        $data['butik_footer_return_status'] = $this->config->get('theme_butik_footer_return_status');
        $data['butik_footer_manufacturer_status'] = $this->config->get('theme_butik_footer_manufacturer_status');
        $data['butik_footer_voucher_status'] = $this->config->get('theme_butik_footer_voucher_status');
        $data['butik_footer_affiliate_status'] = $this->config->get('theme_butik_footer_affiliate_status');
        $data['butik_footer_special_status'] = $this->config->get('theme_butik_footer_special_status');
        $data['butik_footer_phone1'] = $this->config->get('theme_butik_footer_phone1');
        $data['butik_footer_phone2'] = $this->config->get('theme_butik_footer_phone2');
        $data['butik_footer_phone3'] = $this->config->get('theme_butik_footer_phone3');
        $data['butik_footer_phone4'] = $this->config->get('theme_butik_footer_phone4');
        $data['w_footer_phone1'] = preg_replace("/[^0-9]/", "", $this->config->get('theme_butik_footer_phone1'));
        $data['w_footer_phone2'] = preg_replace("/[^0-9]/", "", $this->config->get('theme_butik_footer_phone2'));
        $data['w_footer_phone3'] = preg_replace("/[^0-9]/", "", $this->config->get('theme_butik_footer_phone3'));
        $data['w_footer_phone4'] = preg_replace("/[^0-9]/", "", $this->config->get('theme_butik_footer_phone4'));
        $data['butik_footer_email'] = $this->config->get('theme_butik_footer_email');
        $data['butik_footer_skype'] = $this->config->get('theme_butik_footer_skype');

        if ($this->request->server['HTTPS']) {
            $server = $this->config->get('config_ssl');
        } else {
            $server = $this->config->get('config_url');
        }

        if (is_file(DIR_IMAGE . $this->config->get('theme_butik_image_footer_logo'))) {
            $data['butik_footer_logo'] = $server . 'image/' . $this->config->get('theme_butik_image_footer_logo');
        } else {
            $data['butik_footer_logo'] = '';
        }

        $footer_column1 = $this->config->get('theme_butik_footer_column1');
        if(empty($footer_column1[$this->config->get('config_language_id')])) {
            $data['footer_column1'] = false;
        } elseif (isset($footer_column1[$this->config->get('config_language_id')])) {
            $data['footer_column1'] = html_entity_decode($footer_column1[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
        }

        $footer_column2 = $this->config->get('theme_butik_footer_column2');
        if(empty($footer_column2[$this->config->get('config_language_id')])) {
            $data['footer_column2'] = false;
        } elseif (isset($footer_column2[$this->config->get('config_language_id')])) {
            $data['footer_column2'] = html_entity_decode($footer_column2[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
        }

        $footer_column3 = $this->config->get('theme_butik_footer_column3');
        if(empty($footer_column3[$this->config->get('config_language_id')])) {
            $data['footer_column3'] = false;
        } elseif (isset($footer_column3[$this->config->get('config_language_id')])) {
            $data['footer_column3'] = html_entity_decode($footer_column3[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
        }

        $footer_schedule = $this->config->get('theme_butik_footer_schedule');
        if(empty($footer_schedule[$this->config->get('config_language_id')])) {
            $data['footer_schedule'] = false;
        } elseif (isset($footer_schedule[$this->config->get('config_language_id')])) {
            $data['footer_schedule'] = html_entity_decode($footer_schedule[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
        }

        $footer_location = $this->config->get('theme_butik_footer_location');
        if(empty($footer_location[$this->config->get('config_language_id')])) {
            $data['footer_location'] = false;
        } elseif (isset($footer_location[$this->config->get('config_language_id')])) {
            $data['footer_location'] = html_entity_decode($footer_location[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
        }

        $footer_about_us = $this->config->get('theme_butik_footer_about_us');
        if(empty($footer_about_us[$this->config->get('config_language_id')])) {
            $data['footer_about_us'] = false;
        } elseif (isset($footer_about_us[$this->config->get('config_language_id')])) {
            $data['footer_about_us'] = html_entity_decode($footer_about_us[$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
        }

        $data['theme_butik_footer_links_col1_add'] = array();
        $footer1_link_add = $this->config->get('theme_butik_footer_links_col1_add');
        if (!empty($footer1_link_add)){
            foreach ($footer1_link_add as $key => $value) {
                $data['footer1_link_add'][] = array(
                    'title'  => $value['title'][$this->config->get('config_language_id')],
                    'link'   => $value['link'][$this->config->get('config_language_id')]
                );
                $footer1_link_add_sort[$key] = $value['sort'];
            }
            array_multisort($footer1_link_add_sort, SORT_ASC, $data['footer1_link_add']);
        }

        $data['theme_butik_footer_links_col2_add'] = array();
        $footer2_link_add = $this->config->get('theme_butik_footer_links_col2_add');
        if (!empty($footer2_link_add)){
            foreach ($footer2_link_add as $key => $value) {
                $data['footer2_link_add'][] = array(
                    'title'  => $value['title'][$this->config->get('config_language_id')],
                    'link'   => $value['link'][$this->config->get('config_language_id')]
                );
                $footer2_link_add_sort[$key] = $value['sort'];
            }
            array_multisort($footer2_link_add_sort, SORT_ASC, $data['footer2_link_add']);
        }

        $data['theme_butik_soc_image'] = array();
        $soc_footer = $this->config->get('theme_butik_soc_image');
        if (!empty($soc_footer)){
            foreach ($soc_footer as $key => $value) {
                $data['soc_footer'][] = array(
                    'image' => is_file(DIR_IMAGE . $value['image']) ? $this->model_tool_image->resize($value['image'], 50, 30) : '',
                    'link'  => $value['link'],
                );
            }
        }

        $data['theme_butik_payment_image'] = array();
        $payments_metods = $this->config->get('theme_butik_payment_image');
        if (!empty($payments_metods)){
            foreach ($payments_metods as $key => $value) {
                $data['payments_metods'][] = array(
                    'image' => is_file(DIR_IMAGE . $value['image']) ? $this->model_tool_image->resize($value['image'], 50, 30) : '',
                    'link'  => $value['link'],
                );
            }
        }

        ]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/common/{content_top,content_bottom,column_right,column_left}*.php">
        <operation>
            <search>
                <![CDATA[if ($setting_info && $setting_info['status']) {]]>
            </search>
            <add position="after">
                <![CDATA[
                    $setting_info['position'] = basename(__FILE__, '.php');]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/extension/module/{special,featured,bestseller,latest}*.php">
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="after"><![CDATA[
            $this->load->language('extension/module/butik');

            if ($this->config->get('theme_butik_module_scroll') || $this->config->get('theme_butik_quickview_status')) {
                $this->document->addStyle('catalog/view/theme/butik/js/owl-carousel/owl.carousel.css');
                $this->document->addScript('catalog/view/theme/butik/js/owl-carousel/owl.carousel.min.js');
            }

            $data['position'] = $setting['position'];
            $data['butik_module_scroll'] = $this->config->get('theme_butik_module_scroll');
            $data['butik_hover_img_status'] = $this->config->get('theme_butik_hover_img_status');
            $data['butik_compare_status'] = $this->config->get('theme_butik_compare_status');
            $data['butik_wishlist_status'] = $this->config->get('theme_butik_wishlist_status');
            $data['butik_short_description_status'] = $this->config->get('theme_butik_short_description_status');
            $data['butik_percentage_status'] = $this->config->get('theme_butik_percentage_status');
            $data['butik_no_product'] = $this->config->get('theme_butik_no_product');
            $data['butik_fastorder_module'] = $this->config->get('module_butik_fastorder_module');
            $data['butik_quickview_status'] = $this->config->get('theme_butik_quickview_status');
            ]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/extension/module/featured.php">
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="before" error="skip"><![CDATA[
                $additional_img = $this->model_catalog_product->getProductImages($product_info['product_id']);

                if (isset($additional_img[0]['image']) && !empty($additional_img[0]['image'])) {
                  $additional_img = $this->model_tool_image->resize($additional_img[0]['image'], $setting['width'], $setting['height']);
                } else {
                  $additional_img = false;
                }
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="after" error="skip"><![CDATA['additional_img' => $additional_img,
                'product_quantity' => $product_info['quantity'],
                'entry_stock' => $product_info['stock_status'],]]></add>
        </operation>
        <operation>
            <search><![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $product_info['product_id'])]]></search>
            <add position="replace"><![CDATA['href'    	 => $this->url->link('product/product', 'product_id=' . $product_info['product_id']),
              'percentage' => $product_info['price'] == 0 ? 100 : round((($product_info['price'] - $product_info['special'])/$product_info['price'])*100, 0)]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/extension/module/{special,latest,bestseller}*.php">
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="before" error="skip"><![CDATA[
                $additional_img = $this->model_catalog_product->getProductImages($result['product_id']);

                if (isset($additional_img[0]['image']) && !empty($additional_img[0]['image'])) {
                  $additional_img = $this->model_tool_image->resize($additional_img[0]['image'], $setting['width'], $setting['height']);
                } else {
                  $additional_img = false;
                }
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="after" error="skip"><![CDATA['additional_img' => $additional_img,
                'product_quantity' => $result['quantity'],
                'entry_stock' => $result['stock_status'],]]></add>
        </operation>
        <operation>
            <search><![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'])]]></search>
            <add position="replace"><![CDATA['href'    	 => $this->url->link('product/product', 'product_id=' . $result['product_id']),
          'percentage' => $result['price'] == 0 ? 100 : round((($result['price'] - $result['special'])/$result['price'])*100, 0)]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/checkout/cart.php">
        <operation>
            <search><![CDATA[$this->load->language('checkout/cart');]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/module/butik');]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></search>
            <add position="after"><![CDATA[
                $this->load->model('tool/image');
                if ($product_info['image']) {
                    $image = $this->model_tool_image->resize($product_info['image'], 210,210);
                } else {
                    $image = $this->model_tool_image->resize('placeholder.png', 210, 210);
                }
                $json['image'] = $image;
                $json['name'] = $product_info['name'];
                $json['text_checkout'] = $this->language->get('text_checkout');
                $json['text_cart'] = $this->language->get('text_cart');
                $json['button_shopping'] = $this->language->get('button_shopping');
                $json['link_checkout'] = $this->url->link('checkout/checkout', '', true);
                $json['link_cart'] = $this->url->link('checkout/cart', '', true);
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/{category,manufacturer,search,special}*.php">
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="after"><![CDATA[
            if ($this->config->get('theme_butik_quickview_status')) {
                $this->document->addStyle('catalog/view/theme/butik/js/owl-carousel/owl.carousel.css');
                $this->document->addScript('catalog/view/theme/butik/js/owl-carousel/owl.carousel.min.js');
            }

            $this->load->language('extension/module/butik');
            $data['butik_fastorder_category'] = $this->config->get('module_butik_fastorder_category');
            $data['butik_compare_status'] = $this->config->get('theme_butik_compare_status');
            $data['butik_wishlist_status'] = $this->config->get('theme_butik_wishlist_status');
            $data['butik_short_description_status'] = $this->config->get('theme_butik_short_description_status');
            $data['butik_percentage_status'] = $this->config->get('theme_butik_percentage_status');
            $data['butik_hover_img_status'] = $this->config->get('theme_butik_hover_img_status');
            $data['butik_no_product'] = $this->config->get('theme_butik_no_product');
            $data['butik_quickview_status'] = $this->config->get('theme_butik_quickview_status');
            ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="before" error="skip"><![CDATA[
                $additional_img = $this->model_catalog_product->getProductImages($result['product_id']);

                if (isset($additional_img[0]['image']) && !empty($additional_img[0]['image'])) {
                  $additional_img = $this->model_tool_image->resize($additional_img[0]['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'));
                } else {
                  $additional_img = false;
                }

            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][] = array(]]></search>
            <add position="after" error="skip"><![CDATA['additional_img' => $additional_img,
                'product_quantity' => $result['quantity'],
                'entry_stock' => $result['stock_status'],]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/manufacturer.php">
        <operation>
            <search>
                <![CDATA['href'        => $this->url->link('product/product', 'manufacturer_id=' . $result['manufacturer_id'] . '&product_id=' . $result['product_id'] . $url)]]>
            </search>
            <add position="replace">
                <![CDATA['href'        => $this->url->link('product/product', 'manufacturer_id=' . $result['manufacturer_id'] . '&product_id=' . $result['product_id'] . $url),
          'percentage' => $result['price'] == 0 ? 100 : round((($result['price'] - $result['special'])/$result['price'])*100, 0)]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/product/{search,special}*.php">
        <operation>
            <search>
                <![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url)]]>
            </search>
            <add position="replace">
                <![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url),
          'percentage' => $result['price'] == 0 ? 100 : round((($result['price'] - $result['special'])/$result['price'])*100, 0)]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/product/category.php">
        <operation>
            <search>
                <![CDATA['href'        => $this->url->link('product/product', 'path=' . $this->request->get['path'] . '&product_id=' . $result['product_id'] . $url)]]>
            </search>
            <add position="replace">
                <![CDATA['href'        => $this->url->link('product/product', 'path=' . $this->request->get['path'] . '&product_id=' . $result['product_id'] . $url),
          'percentage' => $result['price'] == 0 ? 100 : round((($result['price'] - $result['special'])/$result['price'])*100, 0)]]>
            </add>
        </operation>
        <operation error="skip">
            <search><![CDATA[$data['header'] = $this->load->controller('common/header');]]></search>
            <add position="after"><![CDATA[
                $data['butik_ctegory_description_status'] = $this->config->get('theme_butik_ctegory_description_status');
                $data['butik_category_list_thumb'] = $this->config->get('theme_butik_category_list_thumb');
              ]]></add>
        </operation>
        <operation error="skip">
            <search><![CDATA[$data['categories'][] = array(]]></search>
            <add position="before"><![CDATA[
            if ($result['image']) {
                $image = $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_category_list_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_category_list_thumb_height'));
            } else {
                $image = '';
            }]]></add>
        </operation>
        <operation error="skip">
            <search><![CDATA[$data['categories'][] = array(]]></search>
            <add position="after"><![CDATA['image'       => $image,]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/compare.php">
        <operation>
            <search><![CDATA[$json['total'] = sprintf($this->language->get('text_compare'), (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0));]]></search>
            <add position="after"><![CDATA[
            $this->load->language('extension/module/butik');
            $json['total'] = sprintf($this->language->get('butik_compare'), (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0));
         ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$data['review_status'] = $this->config->get('config_review_status');]]></search>
            <add position="after" error="skip"><![CDATA[
                    $data['butik_no_product'] = $this->config->get('theme_butik_no_product');]]></add>
        </operation>
        <operation>
            <search><![CDATA[$data['products'][$product_id] = array(]]></search>
            <add position="after" error="skip"><![CDATA[
                    'product_quantity' => $product_info['quantity'],
                    'entry_stock' => $product_info['stock_status'],]]></add>
        </operation>
    </file>

    <file path="catalog/controller/common/cart.php">
        <operation>
            <search><![CDATA[$this->load->language('common/cart');]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/module/butik');
        $data['butik_agree'] = $this->config->get('theme_butik_agree');]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/information/contact.php">
        <operation>
            <search><![CDATA[$this->load->language('information/contact');]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/module/butik');]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$data['button_submit'] = $this->language->get('button_submit');]]></search>
            <add position="after"><![CDATA[
        if (isset($this->error['warning_butik_agree'])) {
            $data['error_warning_butik_agree'] = $this->error['warning_butik_agree'];
        } else {
            $data['error_warning_butik_agree'] = '';
        }
            ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="before"><![CDATA[
        if ($this->config->get('theme_butik_agree')) {
            $this->load->model('catalog/information');

            $information_info = $this->model_catalog_information->getInformation($this->config->get('theme_butik_agree'));

            if ($information_info) {
                $data['text_butik_agree'] = sprintf($this->language->get('text_butik_agree'), $this->url->link('information/information/agree', 'information_id=' . $this->config->get('theme_butik_agree'), true), $information_info['title'], $information_info['title']);
            } else {
                $data['text_butik_agree'] = '';
            }
        } else {
            $data['text_butik_agree'] = '';
        }

        if (isset($this->request->post['agree'])) {
            $data['agree'] = $this->request->post['agree'];
        } else {
            $data['agree'] = false;
        }
        ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[return !$this->error;]]></search>
            <add position="before"><![CDATA[
        if ($this->config->get('theme_butik_agree')) {
            $this->load->model('catalog/information');

            $information_info = $this->model_catalog_information->getInformation($this->config->get('theme_butik_agree'));

            if ($information_info && !isset($this->request->post['agree'])) {
                $this->error['warning_butik_agree'] = sprintf($this->language->get('error_butik_agree'), $information_info['title']);
            }
        }
            ]]>
            </add>
        </operation>
    </file>

    <file path="catalog/controller/product/product.php">
        <operation error="log">
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="after"><![CDATA[
            if ($this->config->get('module_butik_additional_tabs_status')) {
                $data['additionaltabs'] = array();
                $addtabs = $this->model_catalog_product->getProducttabs($this->request->get['product_id']);
                foreach ($addtabs as $result) {
                    $data['additionaltabs'][] = array(
                        'title' => $result['title'],
                        'description' => html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8')
                    );
                }
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/model/catalog/product.php">
        <operation error="log">
            <search><![CDATA[public function getLatestProducts($limit) {]]></search>
            <add position="before"><![CDATA[
    public function getProducttabs($product_id) {
        $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_addtab pa LEFT JOIN " . DB_PREFIX . "product_addtab_description pad ON (pa.product_addtab_id  = pad.product_addtab_id) WHERE pa.product_id = '" . (int)$product_id . "'  AND pad.language_id = '" . (int)$this->config->get('config_language_id') . "' AND status = 1 ORDER BY sort_order ASC");

        return $query->rows;
    }
            ]]></add>
        </operation>
    </file>

</modification>